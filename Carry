-- Carry Tool (Piggyback Version)
local Tool = Instance.new("Tool")
Tool.Name = "CarryTool"
Tool.RequiresHandle = false
Tool.CanBeDropped = false
Tool.Parent = game.Players.LocalPlayer.Backpack

local carrying = false
local carriedPlayer = nil
local weld = nil

-- Function cari player terdekat
local function getClosestPlayer(character, range)
	local closest = nil
	local shortest = range or 10
	for _, plr in pairs(game.Players:GetPlayers()) do
		if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and plr ~= game.Players.LocalPlayer then
			local mag = (plr.Character.HumanoidRootPart.Position - character.HumanoidRootPart.Position).magnitude
			if mag < shortest then
				shortest = mag
				closest = plr
			end
		end
	end
	return closest
end

-- Fungsi NoCollide biar karakter gak tabrakan
local function noCollide(char1, char2)
	for _, p1 in pairs(char1:GetDescendants()) do
		if p1:IsA("BasePart") then
			for _, p2 in pairs(char2:GetDescendants()) do
				if p2:IsA("BasePart") then
					local noCol = Instance.new("NoCollisionConstraint")
					noCol.Part0 = p1
					noCol.Part1 = p2
					noCol.Parent = p1
				end
			end
		end
	end
end

Tool.Activated:Connect(function()
	local char = Tool.Parent
	local humRoot = char:FindFirstChild("HumanoidRootPart")
	if not humRoot then return end

	if carrying then
		-- Lepaskan
		if weld then
			weld:Destroy()
			weld = nil
		end
		carriedPlayer = nil
		carrying = false
	else
		-- Cari target
		local target = getClosestPlayer(char, 10)
		if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
			carriedPlayer = target
			local targetRoot = target.Character.HumanoidRootPart

			-- Atur posisi di belakang punggung (piggyback)
			targetRoot.CFrame = humRoot.CFrame * CFrame.new(0, 1, 1)

			-- Weld agar nempel ke punggung
			weld = Instance.new("Weld")
			weld.Part0 = humRoot
			weld.Part1 = targetRoot
			weld.C0 = CFrame.new(0, 1, 1) -- posisi belakang
			weld.Parent = humRoot

			-- Nonaktifkan tabrakan
			noCollide(char, target.Character)

			carrying = true
		end
	end
end)

Tool.Unequipped:Connect(function()
	if weld then
		weld:Destroy()
		weld = nil
	end
	carrying = false
	carriedPlayer = nil
end)
